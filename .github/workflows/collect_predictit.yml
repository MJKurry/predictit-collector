name: Collect PredictIt Snapshots

on:
  schedule:
    - cron: "*/15 * * * *"   # alle 15 Minuten (UTC)
  workflow_dispatch: {}

jobs:
  collect:
    runs-on: ubuntu-latest
    timeout-minutes: 5
    steps:
      - uses: actions/checkout@v4

      - name: Setup R
        uses: r-lib/actions/setup-r@v2
        with:
          r-version: '4.3.3'   # feste Version -> Cache bleibt stabil

      # renv: nutzt renv.lock + Cache -> keine Neuinstallation jedes Mal
      - name: Setup renv
        uses: r-lib/actions/setup-renv@v2

      - name: Run collector
        run: Rscript scripts/30_predictit_collect_snapshot.R

      - name: Upload snapshot artifact
        uses: actions/upload-artifact@v4
        with:
          name: predictit_snapshots_${{ github.run_number }}
          path: data/snapshots/predictit
